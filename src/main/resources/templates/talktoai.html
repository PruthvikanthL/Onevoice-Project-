<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Talk to Chiru â€“ One Voice Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
          font-family: 'Poppins', sans-serif;
          background: #0e0e0e;
          color: #fff;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: flex-start;
          min-height: 100vh;
          overflow: hidden;
        }

        /* Subtle floating emoji background */
        .emoji-bg {
          position: absolute;
          width: 100%;
          height: 100%;
          top: 0; left: 0;
          pointer-events: none;
          overflow: hidden;
        }
        .emoji-bg span {
          position: absolute;
          font-size: 35px;
          opacity: 0.08;
          animation: float 14s ease-in-out infinite;
        }
        @keyframes float {
          0% { transform: translateY(0) rotate(0deg); }
          50% { transform: translateY(-40px) rotate(20deg); }
          100% { transform: translateY(0) rotate(-20deg); }
        }

        /* Welcome Section */
        .welcome-section {
          text-align: center;
          margin-top: 50px;
          animation: fadeIn 1s ease-out;
          z-index: 1;
        }

        .welcome-section h1 {
          font-size: 2rem;
          color: #00B5B5;
        }

        .welcome-section p {
          color: #bbb;
          margin-top: 6px;
          font-size: 1rem;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        /* Chat Box */
        .chat-box {
          width: 90%;
          max-width: 850px;
          height: 70vh;
          margin-top: 30px;
          background: rgba(255, 255, 255, 0.05);
          border-radius: 20px;
          border: 1px solid rgba(255, 255, 255, 0.1);
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
          display: flex;
          flex-direction: column;
          overflow: hidden;
          z-index: 1;
        }

        .chat-messages {
          flex-grow: 1;
          padding: 20px;
          overflow-y: auto;
          scroll-behavior: smooth;
        }

        .message {
          max-width: 75%;
          margin-bottom: 15px;
          padding: 12px 18px;
          border-radius: 20px;
          line-height: 1.5;
          word-wrap: break-word;
          animation: fadeIn 0.3s ease-in;
        }

        .user {
          background: linear-gradient(135deg, #00B5B5, #009999);
          align-self: flex-end;
          color: white;
        }

        .ai {
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.1);
          align-self: flex-start;
          color: #f8f8f8;
        }

        /* Input Area */
        .input-area {
          display: flex;
          padding: 18px;
          background: rgba(255, 255, 255, 0.03);
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-area input {
          flex: 1;
          padding: 14px 18px;
          border: none;
          border-radius: 25px;
          outline: none;
          background: rgba(255, 255, 255, 0.1);
          color: white;
          font-size: 1rem;
        }

        .input-area button {
          margin-left: 10px;
          background: linear-gradient(90deg, #00B5B5, #FF6E2F);
          border: none;
          border-radius: 25px;
          padding: 14px 25px;
          color: white;
          font-weight: 600;
          cursor: pointer;
          transition: 0.2s ease-in;
        }

        .input-area button:hover {
          transform: scale(1.05);
          box-shadow: 0 0 10px rgba(255, 110, 47, 0.5);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 10px;
        }
    </style>
</head>
<body>

<!-- Floating emojis -->
<div class="emoji-bg">
    <span style="top:10%; left:10%;">ðŸ’¬</span>
    <span style="top:25%; left:80%;">ðŸ¤–</span>
    <span style="top:60%; left:20%;">âœ¨</span>
    <span style="top:70%; left:70%;">ðŸ’¡</span>
    <span style="top:40%; left:50%;">ðŸ’­</span>
</div>

<div class="welcome-section">
    <h1>Hey <span th:text="${username}"></span> ðŸ‘‹</h1>
    <p>Iâ€™m <strong style="color:#FF6E2F;">Chiru</strong> â€” your One Voice AI Assistant.</p>
    <p>Ask me anything â€” Iâ€™m here to help you out!</p>
</div>

<div class="chat-box">
    <div class="chat-messages" id="chat-container">
        <div class="message ai">ðŸ‘‹ Hello! Iâ€™m Chiru. How can I assist you today?</div>
    </div>

    <div class="input-area">
        <input id="user-input" type="text" placeholder="Type your message..." onkeydown="if(event.key==='Enter') sendMessage()" />
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    const chatContainer = document.getElementById('chat-container');
    const inputField = document.getElementById('user-input');

    function appendMessage(sender, text) {
      const msg = document.createElement('div');
      msg.classList.add('message', sender);
      chatContainer.appendChild(msg);

      if (sender === 'ai') {
        let i = 0;
        const interval = setInterval(() => {
          msg.textContent = text.slice(0, i++);
          if (i > text.length) clearInterval(interval);
          chatContainer.scrollTop = chatContainer.scrollHeight;
        }, 25);
      } else {
        msg.textContent = text;
      }

      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function sendMessage() {
      const userMessage = inputField.value.trim();
      if (userMessage === '') return;

      appendMessage('user', userMessage);
      inputField.value = '';
      appendMessage('ai', 'Typing...');

      const response = await fetch('/api/chiru/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userMessage)
      });

      const aiReply = await response.text();
      chatContainer.lastChild.remove();
      appendMessage('ai', aiReply);
    }
</script>
</body>
</html>
